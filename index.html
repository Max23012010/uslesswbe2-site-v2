<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Trippy Infinite Zoom â€” Robust Audio</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
    background: #000;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }

  canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    display: block;
    filter: contrast(1.3) brightness(1.2) saturate(1.6);
  }

  .overlay {
    position: fixed;
    bottom: 20px;
    width: 100%;
    text-align: center;
    color: white;
    pointer-events: none;
    font-size: 1.1rem;
  }

  /* small unobtrusive enable-sound control */
  #enableSound {
    position: fixed;
    top: 18px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 9999;
    padding: 10px 18px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.12);
    background: rgba(0,0,0,0.45);
    color: white;
    cursor: pointer;
    font-size: 14px;
    backdrop-filter: blur(6px);
    transition: opacity .6s ease, transform .25s ease;
    pointer-events: auto;
  }
  #enableSound.hidden {
    opacity: 0;
    transform: translateX(-50%) translateY(-8px) scale(.98);
    pointer-events: none;
  }

  /* if audio blocked, show a subtle pulse */
  #enableSound.pulse {
    animation: pulse 1.6s infinite;
  }
  @keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(255,255,255,0.06); }
    70% { box-shadow: 0 0 0 8px rgba(255,255,255,0.00); }
    100% { box-shadow: 0 0 0 0 rgba(255,255,255,0.00); }
  }
</style>
</head>
<body>
<canvas id="zoomCanvas"></canvas>
<div class="overlay">ðŸŒ€ Move your mouse... fall deeper ðŸŒ€</div>

<!-- Hidden audio element; playsinline helps mobile browsers -->
<audio id="bgMusic" autoplay loop muted playsinline style="display:none;">
  <source src="https://dn721507.ca.archive.org/0/items/golden_202510/Golden.mp3" type="audio/mpeg">

  Your browser doesn't support the audio element.
</audio>

<!-- Enable-sound button shows only if autoplay blocked -->
<button id="enableSound" class="hidden">Enable Sound ðŸ”Š</button>

<script>
(function(){
  const audio = document.getElementById('bgMusic');
  const enableBtn = document.getElementById('enableSound');
  let autoplaySucceeded = false;
  let fadeInterval = null;

  // Animation canvas setup (same as before)
  const canvas = document.getElementById('zoomCanvas');
  const ctx = canvas.getContext && canvas.getContext('2d');
  if (!ctx) {
    console.error('Canvas 2D context unavailable.');
  } else {
    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    let mouseX = 0, mouseY = 0;
    window.addEventListener('mousemove', (e) => {
      mouseX = (e.clientX / window.innerWidth - 0.5) * 2;
      mouseY = (e.clientY / window.innerHeight - 0.5) * 2;
    });

    const img = new Image();
    img.crossOrigin = 'anonymous';
    img.src = 'https://www.dropbox.com/scl/fi/xmja9rqztz8gwk6jjux4i/Studio_20231231_193239-removebg-preview.png?raw=1';
    img.onload = () => { console.info('Image loaded.'); startAnimation(); };
    img.onerror = (err) => {
      console.warn('Image load failed, using fallback.', err);
      img.src = 'https://images.unsplash.com/photo-1543852786-1cf6624b9987?auto=format&fit=crop&w=1920&q=80';
    };

    function startAnimation(){
      let t = 0;
      function draw(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.save();
        ctx.translate(canvas.width / 2 + mouseX * 100, canvas.height / 2 + mouseY * 100);
        const baseScale = Math.max(canvas.width / img.width, canvas.height / img.height) * 1.05;
        const layers = 45;
        for (let i = 0; i < layers; i++) {
          const layerScale = baseScale * Math.pow(0.9, i) * (1 + 0.05 * Math.sin(t/30));
          ctx.save();
          ctx.scale(layerScale, layerScale);
          ctx.rotate(0.03 * Math.sin(t/40 + i/5));
          ctx.globalAlpha = Math.max(0, 1 - i / layers);
          ctx.drawImage(img, -img.width / 2, -img.height / 2);
          ctx.restore();
        }
        ctx.restore();
        t += 1;
        requestAnimationFrame(draw);
      }
      requestAnimationFrame(draw);
    }
  }

  // Attempt autoplay (muted) then fade in
  function attemptAutoplayWithFade() {
    // start muted so autoplay usually allowed
    audio.muted = true;
    audio.volume = 0;
    // try play()
    audio.play().then(() => {
      console.info('Autoplay allowed (muted). Starting fade-in...');
      autoplaySucceeded = true;
      // unmute then fade to volume 1. Use small increments.
      audio.muted = false;
      if (fadeInterval) clearInterval(fadeInterval);
      let v = 0;
      fadeInterval = setInterval(() => {
        v = Math.min(1, +(v + 0.03).toFixed(3));
        audio.volume = v;
        if (v >= 1) {
          clearInterval(fadeInterval);
          console.info('Fade-in complete.');
        }
      }, 120); // ~4 seconds fade
      hideEnableButton();
    }).catch(err => {
      console.warn('Autoplay attempt failed:', err);
      showEnableButton();
    });
  }

  // We attempt autoplay straight away
  attemptAutoplayWithFade();

  // Also try on the first pointerdown or keydown (some mobile browsers require an actual user gesture)
  function userGestureHandler() {
    if (autoplaySucceeded) return;
    console.info('Detected user gesture â€” trying to start audio.');
    attemptAutoplayWithFade();
  }
  window.addEventListener('pointerdown', userGestureHandler, { once: true });
  window.addEventListener('keydown', userGestureHandler, { once: true });

  // Button behavior
  function showEnableButton(){
    enableBtn.classList.remove('hidden');
    // add pulse to attract attention (but subtle)
    enableBtn.classList.add('pulse');
  }
  function hideEnableButton(){
    enableBtn.classList.add('hidden');
    enableBtn.classList.remove('pulse');
  }

  enableBtn.addEventListener('click', () => {
    console.info('Enable Sound button clicked; attempting to play audio.');
    // Some browsers may still require a fresh play attempt via click
    audio.muted = false;
    audio.volume = 0;
    audio.play().then(() => {
      autoplaySucceeded = true;
      // fade in
      if (fadeInterval) clearInterval(fadeInterval);
      let v = 0;
      fadeInterval = setInterval(() => {
        v = Math.min(1, +(v + 0.03).toFixed(3));
        audio.volume = v;
        if (v >= 1) {
          clearInterval(fadeInterval);
          console.info('Fade-in complete after user click.');
        }
      }, 120);
      hideEnableButton();
    }).catch(err => {
      console.error('Play failed even after click:', err);
      // keep the button visible so user can try again
      showEnableButton();
    });
  });

  // Give feedback in console: helpful for debugging
  audio.addEventListener('play', () => console.log('Audio element: play event.'));
  audio.addEventListener('pause', () => console.log('Audio element: pause event.'));
  audio.addEventListener('error', (e) => console.error('Audio element error:', e));

  // Useful dev tip for you: open devtools (F12) > Console to inspect logs if it "doesn't work".
})();
</script>
</body>
</html>
